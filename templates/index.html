<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Início</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesh.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}">
</head>
<body>
    <div class="container">    
        <a href="{{ url_for('login') }}" class="criar">Fazer login</a>
        <a href="{{ url_for('logout') }}" class="criar">Encerrar sessão</a>
        <a href="{{ url_for('agendar') }}" class="criar">Criar novo agendamento</a>
        <a href="{{ url_for('pagcadastro') }}" class="criar">Criar usuário</a>
        <a href="{{ url_for('admpagina') }}" class="criar">Pagina do Administrador</a>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %} 
                <ul id="messages" class="list-unstyled">
                    {% for message in messages %}
                        <li class="alert alert-success">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div class="texto">Agendamentos</div>
        <div class="form-group">
            <label for="filter-periodo">Filtrar por Período:</label>
            <select id="filter-periodo" class="form-control">
                <option value="">Todos</option>
                <option value="MATUTINO">MATUTINO</option>
                <option value="VESPERTINO">VESPERTINO</option>
                <option value="NOTURNO">NOTURNO</option>
            </select>
        </div>
        <div class="form-group">
            <label for="filter-data">Filtrar por Data:</label>
            <input type="date" id="filter-data" class="form-control">
        </div>
        <div>
            <table id="agendamentos" class="table table-striped table-responsive table-bordered">
                <thead class="thead-default">
                    <tr>
                        <th> ID </th>
                        <th> Data </th>
                        <th> Período </th>
                        <th> Professor </th>
                        <th> Matéria </th>
                        <th>  </th>
                    </tr>
                </thead>
                <tbody>
                    {% for agendamento in agendamentos %}
                    <tr data-periodo="{{ agendamento.periodo }}" data-data="{{ agendamento.data }}">
                        <td>{{ agendamento.id }}</td>
                        <td>{{ agendamento.data }}</td>
                        <td>{{ agendamento.periodo }}</td>
                        <td>{{ agendamento.professor }}</td>
                        <td>{{ agendamento.materia }}</td>
                        {% if agendamento.professor == session['usuarioLogado'] %}
                        <td> <a class="criar" href="{{url_for('deletar', id=agendamento.id, professor=agendamento.professor)}}"> Excluir</a> </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <script type="text/javascript" src="{{ url_for('static', filename='jquery.js') }}"></script>
            <script type="text/javascript" src="{{ url_for('static', filename='app.js') }}"></script>
            
            <script>
                // JavaScript para ativar a validação Bootstrap
                (function() {
                    'use strict';
                    window.addEventListener('load', function() {
                        var forms = document.getElementsByTagName('form');
                        var validation = Array.prototype.filter.call(forms, function(form) {
                            form.addEventListener('submit', function(event) {
                                if (form.checkValidity() === false) {
                                    event.preventDefault();
                                    event.stopPropagation();
                                }
                                form.classList.add('was-validated');
                            }, false);
                        });
                    }, false);
                })();
            </script>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            function filterRows() {
                var selectedPeriodo = $('#filter-periodo').val();
                var selectedData = $('#filter-data').val();
                $('#agendamentos tbody tr').each(function(){
                    var periodo = $(this).data('periodo');
                    var data = $(this).data('data');
                    var showPeriodo = (selectedPeriodo === "" || periodo === selectedPeriodo);
                    var showData = (selectedData === "" || data === selectedData);
                    if (showPeriodo && showData) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }

            $('#filter-periodo').change(filterRows);
            $('#filter-data').change(filterRows);
        });
    </script>
</body>
</html>